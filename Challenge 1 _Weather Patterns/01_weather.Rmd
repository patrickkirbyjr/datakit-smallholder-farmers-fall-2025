---
title: "Weather"
output: html_notebook
---

DataKind Event with Producer's Direct (November 2025)

---

import required libraries
```{r}
library(dplyr)
library(ggplot2)
library(tm)
library(data.table)
library(lubridate)
library(stringr)
```

read dataset using fread (optimized for speed)
```{r}
pd <- fread("data/producers_direct_raw_data.csv")
pd
```

let's look at the question dates
```{r}
summary(pd$question_sent)
```

determine the number of questions sent per month
assign months to season
```{r}
months <- pd |>
  mutate(
    month = month(question_sent),
    month_abb = factor(month, levels = 1:12, labels = month.abb),
    season = case_when(
      month %in% c(12,1,2) ~ "Winter",
      month %in% c(3,4,5) ~ "Spring",
      month %in% c(6,7,8) ~ "Summer",
      month %in% c(9,10,11) ~ "Fall"
    )
  ) |>
  count(month_abb, season, name = "questions")
months
```

visualize questions by month/season
```{r}
ggplot(months, aes(x = month_abb, y = questions, fill = season)) +
  geom_col(alpha = 0.8) +
  scale_fill_manual(
    values = c(
      "Winter" = "#273E47",
      "Spring" = "#D8C99B",
      "Summer" = "#A4243B",
      "Fall" = "#BD632F"
    )
  ) +
  labs(
    title = "Questions Asked by Month",
    x = "Month",
    y = "Questions Sent",
    fill = "Season"
  )
ggsave("graphics/questions_by_month.png")
```

grand total for questions asked by season
```{r}
season_totals <- months |>
  group_by(season) |>
  summarise(season_total = sum(questions))
season_totals
```

visualize questions by season
```{r}
season_totals <- season_totals |>
  mutate(season = factor(season, levels = c("Winter", "Spring", "Summer", "Fall")))

ggplot(season_totals, aes(x = season, y = season_total, fill = season)) +
  geom_col(alpha = 0.8) +
  scale_y_continuous(labels = scales::comma) +
  geom_text(aes(label = season_total), vjust = -0.3) +
  scale_fill_manual(
    values = c(
      "Winter" = "#273E47",
      "Spring" = "#D8C99B",
      "Summer" = "#A4243B",
      "Fall" = "#BD632F"
    )
  ) +
  labs(
    title = "Questions Asked by Season",
    x = "Season",
    y = "Questions Sent",
    fill = "Season"
  )
```

let's break each one down by country to country-specific season patterns



KENYA
```{r}
ke <- fread("data/by_country/kenya.csv")
ke
```

```{r}
kenya_farming <- ke |>
  mutate(
    month = month(question_sent),
    month_abb = factor(month, levels = 1:12, labels = month.abb),
    season = case_when(
      month %in% c(1,2) ~ "Harvest",
      month %in% c(3,4,5) ~ "Planting",
      month %in% c(6,7,8) ~ "Harvest",
      month %in% c(9) ~ "Gap",
      month %in% c(10,11,12) ~ "Planting"
    )
  ) |>
  count(month_abb, season, name = "questions")
kenya_farming
```

```{r}
kenya_farming <- kenya_farming |>
  mutate(season = factor(season, levels = c("Planting", "Harvest", "Gap")))

ggplot(kenya_farming, aes(x = month_abb, y = questions, fill = season)) +
  geom_col(alpha = 0.8) +
  scale_fill_manual(
    values = c(
      "Harvest" = "#A65E2E",
      "Planting" = "#3A5F4A",
      "Gap" = "#6E6A5E"
    )
  ) +
  labs(
    title = "Questions Asked by Month (Kenya)",
    x = "Month",
    y = "Questions Sent",
    fill = "Farming Season"
  )
```

grand total for questions asked by farming season
```{r}
kenya_totals <- kenya_farming |>
  group_by(season) |>
  summarise(season_total = sum(questions))
kenya_totals
```

visualize questions by farming season
```{r}
kenya_totals <- kenya_totals |>
  mutate(season = factor(season, levels = c("Planting", "Harvest", "Gap")))

ggplot(kenya_totals, aes(x = season, y = season_total, fill = season)) +
  geom_col(alpha = 0.8) +
  scale_y_continuous(labels = scales::comma) +
  geom_text(aes(label = season_total), vjust = -0.3) +
  scale_fill_manual(
    values = c(
      "Harvest" = "#A65E2E",
      "Planting" = "#3A5F4A",
      "Gap" = "#6E6A5E"
    )
  ) +
  labs(
    title = "Questions Asked by Farming Season (Kenya)",
    x = "Farming Season",
    y = "Questions Sent",
    fill = "Season"
  )
```

let's look at topic breakdown by season (NAs excluded)
```{r}
kenya_topic_breakdown <- ke |>
  mutate(
    month = month(question_sent),
    season = case_when(
      month %in% c(1,2,6,7,8) ~ "Harvest",
      month %in% c(3,4,5,10,11,12) ~ "Planting",
      month %in% c(9) ~ "Gap",
    )
  ) |>
  filter(!question_topic == "") |>
  count(season, question_topic, name = "questions_asked", sort = TRUE)
kenya_topic_breakdown
```


```{r}
top_planting_topics <- kenya_topic_breakdown |>
  filter(season == "Planting") |>
  arrange(desc(questions_asked)) |>
  head(10)
top_planting_topics
```

```{r}
ggplot(top_planting_topics, aes(x = reorder(question_topic, -questions_asked), y = questions_asked)) +
  geom_col(alpha = 0.8, fill = "#3A5F4A") +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Top Question Topics in Planting Season (Kenya)",
    x = "Question Topic",
    y = "Questions Sent"
  )
```

```{r}
ggplot(top_harvest_topics, aes(x = reorder(question_topic, -questions_asked), y = questions_asked)) +
  geom_col(alpha = 0.8, fill = "#A65E2E") +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Top Question Topics in Harvest Season (Kenya)",
    x = "Question Topic",
    y = "Questions Sent"
  )
```

```{r}
ggplot(top_gap_topics, aes(x = reorder(question_topic, -questions_asked), y = questions_asked)) +
  geom_col(alpha = 0.8, fill = "#6E6A5E") +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Top Question Topics in Gap Season (Kenya)",
    x = "Question Topic",
    y = "Questions Sent"
  )
```





```{r}
top_harvest_topics <- kenya_topic_breakdown |>
  filter(season == "Harvest") |>
  head(10)
top_harvest_topics
```

```{r}
top_gap_topics <- kenya_topic_breakdown |>
  filter(season == "Gap") |>
  head(10)
top_gap_topics
```








UGANDA
```{r}
ug <- fread("data/by_country/uganda.csv")
ug
```

```{r}
uganda_farming <- ug |>
  mutate(
    month = month(question_sent),
    month_abb = factor(month, levels = 1:12, labels = month.abb),
    season = case_when(
      month %in% c(12,1,2) ~ "Harvest",
      month %in% c(3,4,5) ~ "Planting",
      month %in% c(6,7,8) ~ "Harvest",
      month %in% c(9,10,11) ~ "Planting"
    )
  ) |>
  count(month_abb, season, name = "questions")
uganda_farming
```

```{r}
uganda_farming <- uganda_farming |>
  mutate(season = factor(season, levels = c("Planting", "Harvest")))

ggplot(uganda_farming, aes(x = month_abb, y = questions, fill = season)) +
  geom_col(alpha = 0.8) +
  scale_fill_manual(
    values = c(
      "Harvest" = "#A65E2E",
      "Planting" = "#3A5F4A"
    )
  ) +
  labs(
    title = "Questions Asked by Month (Uganda)",
    x = "Month",
    y = "Questions Sent",
    fill = "Farming Season"
  )
```

grand total for questions asked by farming season
```{r}
uganda_totals <- uganda_farming |>
  group_by(season) |>
  summarise(season_total = sum(questions))
uganda_totals
```

visualize questions by farming season
```{r}
uganda_totals <- uganda_totals |>
  mutate(season = factor(season, levels = c("Planting", "Harvest")))

ggplot(uganda_totals, aes(x = season, y = season_total, fill = season)) +
  geom_col(alpha = 0.8) +
  scale_y_continuous(labels = scales::comma) +
  geom_text(aes(label = season_total), vjust = -0.3) +
  scale_fill_manual(
    values = c(
      "Harvest" = "#A65E2E",
      "Planting" = "#3A5F4A"
    )
  ) +
  labs(
    title = "Questions Asked by Farming Season (Uganda)",
    x = "Farming Season",
    y = "Questions Sent",
    fill = "Season"
  )
```



TANZANIA
```{r}
tz <- fread("data/by_country/tanzania.csv")
tz
```

```{r}
tanzania_farming <- tz |>
  mutate(
    month = month(question_sent),
    month_abb = factor(month, levels = 1:12, labels = month.abb),
    season = case_when(
      month %in% c(3,4,5) ~ "Planting (Maskia Rains)",
      month %in% c(6,7,8) ~ "Harvest",
      month %in% c(1,2,9) ~ "Gap",
      month %in% c(10,11,12) ~ "Planting (Vuli Rains)"
    )
  ) |>
  count(month_abb, season, name = "questions")
tanzania_farming
```

```{r}
tanzania_farming <- tanzania_farming |>
  mutate(season = factor(season, levels = c("Planting (Maskia Rains)", "Planting (Vuli Rains)", "Harvest", "Gap")))

ggplot(tanzania_farming, aes(x = month_abb, y = questions, fill = season)) +
  geom_col(alpha = 0.8) +
  scale_fill_manual(
    values = c(
      "Planting (Maskia Rains)" = "#355E4C",
      "Planting (Vuli Rains)" = "#6B6E3A",
      "Harvest" = "#A65E2E",
      "Gap" = "#6E6A5E"
    )
  ) +
  labs(
    title = "Questions Asked by Month (Tanzania)",
    x = "Month",
    y = "Questions Sent",
    fill = "Farming Season"
  )
```

grand total for questions asked by farming season
```{r}
tanzania_totals <- tanzania_farming |>
  group_by(season) |>
  summarise(season_total = sum(questions))
tanzania_totals
```

visualize questions by farming season
```{r}
tanzania_totals <- tanzania_totals |>
  mutate(season = factor(season, levels = c("Planting (Maskia Rains)", "Planting (Vuli Rains)", "Harvest", "Gap")))

ggplot(tanzania_totals, aes(x = season, y = season_total, fill = season)) +
  geom_col(alpha = 0.8) +
  scale_y_continuous(labels = scales::comma) +
  geom_text(aes(label = season_total), vjust = -0.3) +
  scale_fill_manual(
    values = c(
      "Planting (Maskia Rains)" = "#355E4C",
      "Planting (Vuli Rains)" = "#6B6E3A",
      "Harvest" = "#A65E2E",
      "Gap" = "#6E6A5E"
    )
  ) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 12)) +
  labs(
    title = "Questions Asked by Farming Season (Tanzania)",
    x = "Farming Season",
    y = "Questions Sent",
    fill = "Season"
  )
```







Findings:
1. Questions increase in frequency throughout the year with the most being asked in the fall. This corresponds to harvest time.


